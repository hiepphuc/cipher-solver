<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• Gi·∫£i M√£ M·∫≠t M√£ H·ªçc</title>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel ƒë·ªÉ x·ª≠ l√Ω JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#111827',
                            card: '#1f2937',
                            text: '#f3f4f6',
                            input: '#374151',
                            border: '#4b5563'
                        }
                    },
                    fontFamily: {
                        math: ['"Times New Roman"', 'serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .math-font { font-family: 'Times New Roman', serif; font-style: italic; }
        .step-row:nth-child(even) { background-color: rgba(0, 0, 0, 0.02); }
        .dark .step-row:nth-child(even) { background-color: rgba(255, 255, 255, 0.05); }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #4b5563; }
        
        .matrix-bracket {
            border-left: 2px solid currentColor;
            border-right: 2px solid currentColor;
            border-radius: 4px;
            padding: 0 4px;
            display: inline-block;
            vertical-align: middle;
        }
        .transition-colors { transition-property: background-color, border-color, color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300 text-gray-900 dark:text-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const SunIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-yellow-500"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41-1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
        );
        const MoonIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-gray-500"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
        );
        const ExpandIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 15 6 6"/><path d="m15 9 6-6"/><path d="M21 16.2V21h-4.8"/><path d="M21 7.8V3h-4.8"/><path d="M3 21h4.8v-4.8"/><path d="m3 21 6-6"/><path d="M3 3h4.8v4.8"/><path d="m9 9-6-6"/></svg>
        );
        const CloseIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );

        // --- Utility Functions ---
        const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const mod = (n, m) => ((n % m) + m) % m;
        const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
        const extendedGcd = (a, b) => {
            if (b === 0) return { gcd: a, x: 1, y: 0 };
            const { gcd: g, x: x1, y: y1 } = extendedGcd(b, a % b);
            return { gcd: g, x: y1, y: x1 - Math.floor(a / b) * y1 };
        };
        const modInverse = (a, m) => {
            const { gcd: g, x } = extendedGcd(a, m);
            if (g !== 1) return null;
            return mod(x, m);
        };
        const det2x2 = (m) => m[0][0] * m[1][1] - m[0][1] * m[1][0];
        const adj2x2 = (m) => [[m[1][1], -m[0][1]], [-m[1][0], m[0][0]]];
        
        // Helper for simple modular exponentiation (internal use)
        const bigIntPowMod = (base, exp, modVal) => {
            let res = 1n;
            base = base % modVal;
            while (exp > 0n) {
                if (exp % 2n === 1n) res = (res * base) % modVal;
                base = (base * base) % modVal;
                exp /= 2n;
            }
            return res;
        };

        // --- Components ---

        const Section = ({ title, children }) => (
            <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-6 transition-colors duration-300">
                <h2 className="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-4 border-b dark:border-gray-700 pb-2">{title}</h2>
                {children}
            </div>
        );

        const InputGroup = ({ label, value, onChange, type = "text", placeholder = "" }) => (
            <div className="mb-4">
                <label className="block text-gray-700 dark:text-gray-300 font-bold mb-2">{label}</label>
                <input 
                    type={type} 
                    value={value} 
                    onChange={onChange}
                    className="shadow appearance-none border dark:border-gray-600 rounded w-full py-2 px-3 text-gray-700 dark:text-white bg-white dark:bg-gray-700 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500 transition-colors duration-300"
                    placeholder={placeholder}
                />
            </div>
        );

        const Button = ({ onClick, children, variant = "primary" }) => {
            const colors = variant === "primary" 
                ? "bg-blue-500 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-800" 
                : "bg-green-500 hover:bg-green-700 dark:bg-green-600 dark:hover:bg-green-800";
            return (
                <button 
                    onClick={onClick}
                    className={`${colors} text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2 transition-colors duration-300`}
                >
                    {children}
                </button>
            )
        };

        const MatrixDisplay = ({ matrix }) => (
            <div className="inline-block align-middle mx-1">
                <div className="matrix-bracket">
                    <div className="grid grid-cols-2 gap-x-2 gap-y-1 text-center font-mono">
                        <div>{matrix[0][0]}</div><div>{matrix[0][1]}</div>
                        <div>{matrix[1][0]}</div><div>{matrix[1][1]}</div>
                    </div>
                </div>
            </div>
        );

        const ResultBox = ({ result, steps }) => {
            const [isExpanded, setIsExpanded] = useState(false);

            useEffect(() => {
                if (isExpanded) document.body.style.overflow = 'hidden';
                else document.body.style.overflow = 'unset';
                return () => { document.body.style.overflow = 'unset'; }
            }, [isExpanded]);

            if (!result && (!steps || steps.length === 0)) return null;

            return (
                <>
                    <div className="mt-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border border-gray-200 dark:border-gray-600 transition-colors duration-300">
                        <h3 className="font-bold text-lg mb-2 text-gray-800 dark:text-gray-200">K·∫øt qu·∫£:</h3>
                        <div className="text-xl font-mono text-blue-800 dark:text-blue-300 break-all bg-white dark:bg-gray-800 p-3 rounded mb-4 border dark:border-gray-600 shadow-sm">{result}</div>
                        
                        {steps && steps.length > 0 && (
                            <div>
                                <div className="flex justify-between items-center mb-2">
                                    <h4 className="font-bold text-md text-gray-700 dark:text-gray-300">L·ªùi gi·∫£i chi ti·∫øt:</h4>
                                    <button 
                                        onClick={() => setIsExpanded(true)}
                                        className="flex items-center gap-1 text-xs font-semibold bg-blue-100 hover:bg-blue-200 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-700 dark:text-blue-200 px-2 py-1 rounded transition-colors"
                                        title="Ph√≥ng to"
                                    >
                                        <ExpandIcon /> Ph√≥ng to
                                    </button>
                                </div>
                                <div className="text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 p-2 rounded border dark:border-gray-600 max-h-60 overflow-y-auto custom-scrollbar font-mono">
                                    {steps.map((step, idx) => (
                                        <div key={idx} className="step-row py-1 px-1 border-b border-gray-100 dark:border-gray-700 last:border-0">
                                            {step}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {isExpanded && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white dark:bg-gray-900 w-full max-w-5xl h-[90vh] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200">
                                <div className="p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800">
                                    <h3 className="text-xl font-bold text-gray-800 dark:text-white">L·ªùi gi·∫£i chi ti·∫øt</h3>
                                    <button onClick={() => setIsExpanded(false)} className="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-500 dark:text-gray-400 transition-colors"><CloseIcon /></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6 custom-scrollbar bg-white dark:bg-gray-900">
                                    <div className="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800">
                                        <span className="font-bold text-blue-800 dark:text-blue-300 mr-2">K·∫æT QU·∫¢ CU·ªêI C√ôNG:</span>
                                        <span className="font-mono text-xl font-bold text-gray-900 dark:text-white">{result}</span>
                                    </div>
                                    <div className="space-y-1">
                                        {steps.map((step, idx) => (
                                            <div key={idx} className="step-row p-3 rounded text-base md:text-lg text-gray-800 dark:text-gray-200 border-b border-gray-100 dark:border-gray-800">
                                                {step}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        // --- Cipher Modules ---

        const CaesarCipher = () => {
            const [text, setText] = useState("");
            const [key, setKey] = useState(3);
            const [result, setResult] = useState("");
            const [steps, setSteps] = useState([]);

            const process = (isEncrypt) => {
                let log = [];
                const k = parseInt(key);
                if (isNaN(k)) return alert("Kh√≥a k ph·∫£i l√† s·ªë nguy√™n");

                log.push(<div className="font-bold text-blue-600">üîπ C√¥ng th·ª©c: C = (P {isEncrypt ? "+" : "-"} k) mod 26</div>);
                log.push(<div>Kh√≥a <span className="math-font">k</span> = {k}</div>);

                let output = "";
                const cleanText = text.toUpperCase().replace(/[^A-Z]/g, "");
                
                for (let i = 0; i < cleanText.length; i++) {
                    const char = cleanText[i];
                    const pIdx = alphabet.indexOf(char);
                    let cIdx, formula;
                    
                    if (isEncrypt) {
                        cIdx = mod(pIdx + k, 26);
                        formula = <span>'<span className="font-bold">{char}</span>'({pIdx}) + {k} = {pIdx+k} &equiv; {cIdx} (mod 26) &rarr; '<span className="font-bold text-red-500">{alphabet[cIdx]}</span>'</span>;
                    } else {
                        cIdx = mod(pIdx - k, 26);
                        formula = <span>'<span className="font-bold">{char}</span>'({pIdx}) - {k} = {pIdx-k} &equiv; {cIdx} (mod 26) &rarr; '<span className="font-bold text-red-500">{alphabet[cIdx]}</span>'</span>;
                    }
                    log.push(formula);
                    output += alphabet[cIdx];
                }
                setResult(output);
                setSteps(log);
            };

            return (
                <Section title="M√£ Caesar">
                    <InputGroup label="VƒÉn b·∫£n (A-Z)" value={text} onChange={(e) => setText(e.target.value)} />
                    <InputGroup label="Kh√≥a k (D·ªãch chuy·ªÉn)" type="number" value={key} onChange={(e) => setKey(e.target.value)} />
                    <div className="flex">
                        <Button onClick={() => process(true)}>M√£ h√≥a</Button>
                        <Button onClick={() => process(false)} variant="secondary">Gi·∫£i m√£</Button>
                    </div>
                    <ResultBox result={result} steps={steps} />
                </Section>
            );
        };

        const VigenereCipher = () => {
            const [text, setText] = useState("");
            const [key1, setKey1] = useState("");
            const [key2, setKey2] = useState("");
            const [useTwoKeys, setUseTwoKeys] = useState(false);
            const [result, setResult] = useState("");
            const [steps, setSteps] = useState([]);

            const process = (isEncrypt) => {
                let log = [];
                const cleanText = text.toUpperCase().replace(/[^A-Z]/g, "");
                const cleanKey1 = key1.toUpperCase().replace(/[^A-Z]/g, "");
                const cleanKey2 = key2.toUpperCase().replace(/[^A-Z]/g, "");

                if (!cleanKey1) return alert("Vui l√≤ng nh·∫≠p Kh√≥a 1");
                if (useTwoKeys && !cleanKey2) return alert("Vui l√≤ng nh·∫≠p Kh√≥a 2");

                log.push(<div className="font-bold">VƒÉn b·∫£n P: {cleanText}</div>);
                log.push(<div>Kh√≥a K1: {cleanKey1}</div>);
                if (useTwoKeys) log.push(<div>Kh√≥a K2: {cleanKey2}</div>);
                
                let formulaStr = isEncrypt 
                    ? `C = (P + K1 ${useTwoKeys ? '+ K2' : ''}) mod 26`
                    : `P = (C - K1 ${useTwoKeys ? '- K2' : ''}) mod 26`;
                log.push(<div className="font-bold text-blue-600 mb-2">üîπ C√¥ng th·ª©c: {formulaStr}</div>);

                let output = "";
                for (let i = 0; i < cleanText.length; i++) {
                    const char = cleanText[i];
                    const pIdx = alphabet.indexOf(char);
                    const k1Char = cleanKey1[i % cleanKey1.length];
                    const k1Idx = alphabet.indexOf(k1Char);

                    let k2Idx = 0, k2Char = '';
                    if (useTwoKeys) {
                        k2Char = cleanKey2[i % cleanKey2.length];
                        k2Idx = alphabet.indexOf(k2Char);
                    }
                    
                    let cIdx, calc;
                    if (isEncrypt) {
                        cIdx = mod(pIdx + k1Idx + k2Idx, 26);
                        let sum = pIdx + k1Idx + k2Idx;
                        calc = `${pIdx} + ${k1Idx}${useTwoKeys ? ` + ${k2Idx}` : ''} = ${sum}`;
                    } else {
                        cIdx = mod(pIdx - k1Idx - k2Idx, 26);
                        let diff = pIdx - k1Idx - k2Idx;
                        calc = `${pIdx} - ${k1Idx}${useTwoKeys ? ` - ${k2Idx}` : ''} = ${diff}`;
                    }
                    
                    log.push(
                        <div className="flex flex-wrap gap-2 items-center">
                            <span className="w-6 font-bold text-gray-500">[{i+1}]</span>
                            <span>'<span className="font-bold">{char}</span>'</span>
                            <span className="text-gray-400">&rarr;</span>
                            <span className="font-mono text-sm">{calc} &equiv; {cIdx}</span>
                            <span className="text-gray-400">&rarr;</span>
                            <span className="font-bold text-red-500">'{alphabet[cIdx]}'</span>
                            <span className="text-xs text-gray-400 ml-2">(K1:'{k1Char}'{useTwoKeys ? `, K2:'${k2Char}'` : ''})</span>
                        </div>
                    );
                    output += alphabet[cIdx];
                }
                setResult(output);
                setSteps(log);
            };

            return (
                <Section title="M√£ Vigenere (1 & 2 Kh√≥a)">
                    <div className="mb-4">
                        <label className="flex items-center space-x-2 cursor-pointer select-none">
                            <input type="checkbox" checked={useTwoKeys} onChange={(e) => setUseTwoKeys(e.target.checked)} className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300 dark:border-gray-500" />
                            <span className="text-gray-700 dark:text-gray-300 font-bold ml-2">S·ª≠ d·ª•ng 2 kh√≥a (Vigenere 2 Key)</span>
                        </label>
                    </div>
                    <InputGroup label="VƒÉn b·∫£n" value={text} onChange={(e) => setText(e.target.value)} />
                    <div className="flex gap-4">
                        <div className="flex-1"><InputGroup label="Kh√≥a 1 (K1)" value={key1} onChange={(e) => setKey1(e.target.value)} /></div>
                        {useTwoKeys && <div className="flex-1"><InputGroup label="Kh√≥a 2 (K2)" value={key2} onChange={(e) => setKey2(e.target.value)} /></div>}
                    </div>
                    <div className="flex">
                        <Button onClick={() => process(true)}>M√£ h√≥a</Button>
                        <Button onClick={() => process(false)} variant="secondary">Gi·∫£i m√£</Button>
                    </div>
                    <ResultBox result={result} steps={steps} />
                </Section>
            );
        };

        const PlayfairCipher = () => {
            const [text, setText] = useState("");
            const [key, setKey] = useState("");
            const [result, setResult] = useState("");
            const [steps, setSteps] = useState([]);

            const generateMatrix = (k) => {
                let matrix = [];
                let seen = new Set();
                let kClean = k.toUpperCase().replace(/[^A-Z]/g, "").replace(/J/g, "I");
                for(let c of kClean) { if(!seen.has(c)) { seen.add(c); matrix.push(c); } }
                for(let c of alphabet) { if(c !== 'J' && !seen.has(c)) { seen.add(c); matrix.push(c); } }
                return matrix;
            };

            const process = (isEncrypt) => {
                if(!key) return alert("Nh·∫≠p kh√≥a");
                let log = [];
                const matrix = generateMatrix(key);
                
                log.push(
                    <div className="mb-4">
                        <div className="font-bold mb-1">Ma tr·∫≠n kh√≥a (5x5):</div>
                        <div className="inline-block border-2 border-gray-800 dark:border-gray-300 p-1 rounded">
                            <div className="grid grid-cols-5 gap-1 text-center font-mono">
                                {matrix.map((c, i) => <div key={i} className="w-6 h-6 leading-6 bg-gray-200 dark:bg-gray-700">{c}</div>)}
                            </div>
                        </div>
                    </div>
                );

                let cleanText = text.toUpperCase().replace(/[^A-Z]/g, "").replace(/J/g, "I");
                let pairs = [];
                
                if (isEncrypt) {
                    for(let i=0; i<cleanText.length; i++) {
                        let c1 = cleanText[i];
                        let c2 = (i+1 < cleanText.length) ? cleanText[i+1] : 'X';
                        if(c1 === c2) { pairs.push([c1, 'X']); } 
                        else { pairs.push([c1, c2]); i++; }
                    }
                    if(pairs.length > 0 && pairs[pairs.length-1].length === 1) pairs[pairs.length-1].push('X');
                } else {
                    for(let i=0; i<cleanText.length; i+=2) pairs.push([cleanText[i], cleanText[i+1] || 'X']);
                }

                let output = "";
                pairs.forEach((pair, idx) => {
                    let [c1, c2] = pair;
                    let idx1 = matrix.indexOf(c1), idx2 = matrix.indexOf(c2);
                    let r1 = Math.floor(idx1 / 5), c1_pos = idx1 % 5;
                    let r2 = Math.floor(idx2 / 5), c2_pos = idx2 % 5;
                    let res1, res2, rule;

                    if (r1 === r2) { 
                        rule = isEncrypt ? "C√πng h√†ng (D·ªãch ph·∫£i)" : "C√πng h√†ng (D·ªãch tr√°i)";
                        res1 = matrix[r1 * 5 + mod(c1_pos + (isEncrypt?1:-1), 5)];
                        res2 = matrix[r2 * 5 + mod(c2_pos + (isEncrypt?1:-1), 5)];
                    } else if (c1_pos === c2_pos) {
                        rule = isEncrypt ? "C√πng c·ªôt (D·ªãch xu·ªëng)" : "C√πng c·ªôt (D·ªãch l√™n)";
                        res1 = matrix[mod(r1 + (isEncrypt?1:-1), 5) * 5 + c1_pos];
                        res2 = matrix[mod(r2 + (isEncrypt?1:-1), 5) * 5 + c2_pos];
                    } else {
                        rule = "H√¨nh ch·ªØ nh·∫≠t (Giao ƒëi·ªÉm)";
                        res1 = matrix[r1 * 5 + c2_pos];
                        res2 = matrix[r2 * 5 + c1_pos];
                    }

                    log.push(
                        <div key={idx}>
                            <span className="font-bold">{c1}{c2}</span> &rarr; <span className="font-bold text-red-500">{res1}{res2}</span> 
                            <span className="text-sm text-gray-500 ml-2 italic">({rule})</span>
                        </div>
                    );
                    output += res1 + res2;
                });
                setResult(output);
                setSteps(log);
            };

            return (
                <Section title="M√£ Playfair">
                    <InputGroup label="VƒÉn b·∫£n" value={text} onChange={(e) => setText(e.target.value)} />
                    <InputGroup label="Kh√≥a (T·ª´ kh√≥a)" value={key} onChange={(e) => setKey(e.target.value)} />
                    <div className="flex">
                        <Button onClick={() => process(true)}>M√£ h√≥a</Button>
                        <Button onClick={() => process(false)} variant="secondary">Gi·∫£i m√£</Button>
                    </div>
                    <ResultBox result={result} steps={steps} />
                </Section>
            );
        };

        const HillCipher = () => {
            const [text, setText] = useState("");
            const [k00, setK00] = useState(""); const [k01, setK01] = useState("");
            const [k10, setK10] = useState(""); const [k11, setK11] = useState("");
            const [multiplyMode, setMultiplyMode] = useState("Kx");
            const [result, setResult] = useState("");
            const [steps, setSteps] = useState([]);

            const process = (isEncrypt) => {
                let log = [];
                let K = [[parseInt(k00), parseInt(k01)], [parseInt(k10), parseInt(k11)]];
                if(K.flat().some(isNaN)) return alert("Nh·∫≠p ma tr·∫≠n kh√≥a h·ª£p l·ªá");

                let det = det2x2(K);
                let detInv = modInverse(mod(det, 26), 26);
                
                log.push(
                    <div className="mb-2">
                        <span className="font-bold">Ma tr·∫≠n kh√≥a K:</span>
                        <MatrixDisplay matrix={K} />
                    </div>
                );
                
                log.push(<div>Det(K) = {K[0][0]}√ó{K[1][1]} - {K[0][1]}√ó{K[1][0]} = {det}</div>);
                
                if (detInv === null) {
                    log.push(<div className="text-red-500 font-bold">L·ªñI: GCD({mod(det, 26)}, 26) ‚â† 1. Ma tr·∫≠n kh√¥ng kh·∫£ ngh·ªãch!</div>);
                    if(!isEncrypt) return alert("Ma tr·∫≠n kh√¥ng kh·∫£ ngh·ªãch");
                } else {
                    log.push(<div>Ngh·ªãch ƒë·∫£o Det(K)‚Åª¬π mod 26 = {detInv}</div>);
                }

                let MatrixUsed = K;
                
                if (!isEncrypt && detInv !== null) {
                    log.push(<div className="font-bold mt-4 border-t pt-2 border-gray-200 dark:border-gray-700 text-blue-600 dark:text-blue-400">üîπ T√≠nh ma tr·∫≠n ngh·ªãch ƒë·∫£o K‚Åª¬π:</div>);
                    
                    let adj = [
                        [K[1][1], -K[0][1]],
                        [-K[1][0], K[0][0]]
                    ];
                    
                    log.push(
                        <div className="mt-2 flex items-center flex-wrap gap-2">
                            <span>1. Ma tr·∫≠n ph·ª• h·ª£p Adj(K) = </span>
                            <MatrixDisplay matrix={[['d', '-b'], ['-c', 'a']]} />
                            <span> = </span>
                            <MatrixDisplay matrix={adj} />
                        </div>
                    );

                    log.push(
                        <div className="mt-2 flex items-center flex-wrap gap-2">
                            <span>2. K‚Åª¬π = Det(K)‚Åª¬π √ó Adj(K) = {detInv} √ó </span>
                            <MatrixDisplay matrix={adj} />
                            <span> (mod 26)</span>
                        </div>
                    );

                    let val_00 = detInv * adj[0][0], cal_00 = `${detInv}√ó${adj[0][0]}`;
                    let val_01 = detInv * adj[0][1], cal_01 = `${detInv}√ó(${adj[0][1]})`;
                    let val_10 = detInv * adj[1][0], cal_10 = `${detInv}√ó(${adj[1][0]})`;
                    let val_11 = detInv * adj[1][1], cal_11 = `${detInv}√ó${adj[1][1]}`;

                    let K_inv = [
                        [mod(val_00, 26), mod(val_01, 26)],
                        [mod(val_10, 26), mod(val_11, 26)]
                    ];

                    log.push(
                        <div className="mt-2 ml-4 text-sm font-mono bg-gray-100 dark:bg-gray-800 p-2 rounded">
                            <div>H√†ng 1: [{cal_00}, {cal_01}] = [{val_00}, {val_01}] &equiv; [<span className="font-bold text-red-500">{K_inv[0][0]}</span>, <span className="font-bold text-red-500">{K_inv[0][1]}</span>]</div>
                            <div>H√†ng 2: [{cal_10}, {cal_11}] = [{val_10}, {val_11}] &equiv; [<span className="font-bold text-red-500">{K_inv[1][0]}</span>, <span className="font-bold text-red-500">{K_inv[1][1]}</span>]</div>
                        </div>
                    );

                    log.push(
                        <div className="mt-2 mb-2">
                            <span className="font-bold">=> Ma tr·∫≠n ngh·ªãch ƒë·∫£o K‚Åª¬π:</span>
                            <MatrixDisplay matrix={K_inv} />
                        </div>
                    );
                    MatrixUsed = K_inv;
                }

                let cleanText = text.toUpperCase().replace(/[^A-Z]/g, "");
                if (cleanText.length % 2 !== 0) {
                    cleanText += 'X';
                    log.push(<div className="text-orange-500 italic">ƒê√£ th√™m k√Ω t·ª± ƒë·ªám 'X' v√†o cu·ªëi ƒë·ªÉ ƒë·ªß c·∫∑p.</div>);
                }

                log.push(<div className="font-bold text-blue-600 mt-4 border-t pt-2 border-gray-200 dark:border-gray-700">üîπ T√≠nh to√°n ({multiplyMode === 'Kx' ? 'y = Kx' : 'y = xK'}):</div>);

                let output = "";
                for(let i=0; i<cleanText.length; i+=2) {
                    let v1 = alphabet.indexOf(cleanText[i]);
                    let v2 = alphabet.indexOf(cleanText[i+1]);
                    let c1, c2;

                    if (multiplyMode === 'Kx') {
                        log.push(
                            <div className="mt-4 font-bold flex items-center flex-wrap">
                                C·∫∑p: '{cleanText[i]}'({v1}), '{cleanText[i+1]}'({v2}) &rarr; Vector <MatrixDisplay matrix={[[v1], [v2]]} />
                            </div>
                        );
                        
                        let cal1 = `${MatrixUsed[0][0]}√ó${v1} + ${MatrixUsed[0][1]}√ó${v2}`;
                        let cal2 = `${MatrixUsed[1][0]}√ó${v1} + ${MatrixUsed[1][1]}√ó${v2}`;
                        
                        c1 = mod(MatrixUsed[0][0]*v1 + MatrixUsed[0][1]*v2, 26);
                        c2 = mod(MatrixUsed[1][0]*v1 + MatrixUsed[1][1]*v2, 26);

                        log.push(<div className="ml-4">H√†ng 1: [{cal1}] = {MatrixUsed[0][0]*v1 + MatrixUsed[0][1]*v2} &equiv; <span className="font-bold text-red-500">{c1} ({alphabet[c1]})</span></div>);
                        log.push(<div className="ml-4">H√†ng 2: [{cal2}] = {MatrixUsed[1][0]*v1 + MatrixUsed[1][1]*v2} &equiv; <span className="font-bold text-red-500">{c2} ({alphabet[c2]})</span></div>);

                    } else {
                        log.push(
                            <div className="mt-4 font-bold">
                                C·∫∑p: '{cleanText[i]}'({v1}), '{cleanText[i+1]}'({v2}) &rarr; Vector [{v1}, {v2}]
                            </div>
                        );
                        
                        let cal1 = `${v1}√ó${MatrixUsed[0][0]} + ${v2}√ó${MatrixUsed[1][0]}`;
                        let cal2 = `${v1}√ó${MatrixUsed[0][1]} + ${v2}√ó${MatrixUsed[1][1]}`;

                        c1 = mod(v1*MatrixUsed[0][0] + v2*MatrixUsed[1][0], 26);
                        c2 = mod(v1*MatrixUsed[0][1] + v2*MatrixUsed[1][1], 26);

                        log.push(<div className="ml-4">C·ªôt 1: [{cal1}] = {v1*MatrixUsed[0][0] + v2*MatrixUsed[1][0]} &equiv; <span className="font-bold text-red-500">{c1} ({alphabet[c1]})</span></div>);
                        log.push(<div className="ml-4">C·ªôt 2: [{cal2}] = {v1*MatrixUsed[0][1] + v2*MatrixUsed[1][1]} &equiv; <span className="font-bold text-red-500">{c2} ({alphabet[c2]})</span></div>);
                    }
                    output += alphabet[c1] + alphabet[c2];
                }
                setResult(output);
                setSteps(log);
            };

            return (
                <Section title="M√£ Hill (Ma tr·∫≠n 2x2)">
                    <InputGroup label="VƒÉn b·∫£n" value={text} onChange={(e) => setText(e.target.value)} />
                    <div className="mb-4">
                        <label className="block text-gray-700 dark:text-gray-300 font-bold mb-2">Ki·ªÉu nh√¢n ma tr·∫≠n:</label>
                        <div className="flex gap-4">
                            <label className="inline-flex items-center cursor-pointer select-none">
                                <input type="radio" className="form-radio text-blue-600" name="hillMode" value="Kx" checked={multiplyMode === 'Kx'} onChange={() => setMultiplyMode('Kx')} />
                                <span className="ml-2 text-gray-700 dark:text-gray-300">y = Kx (Ma tr·∫≠n &times; C·ªôt)</span>
                            </label>
                            <label className="inline-flex items-center cursor-pointer select-none">
                                <input type="radio" className="form-radio text-blue-600" name="hillMode" value="xK" checked={multiplyMode === 'xK'} onChange={() => setMultiplyMode('xK')} />
                                <span className="ml-2 text-gray-700 dark:text-gray-300">y = xK (H√†ng &times; Ma tr·∫≠n)</span>
                            </label>
                        </div>
                    </div>
                    <div className="mb-4">
                        <label className="block text-gray-700 dark:text-gray-300 font-bold mb-2">Ma tr·∫≠n kh√≥a:</label>
                        <div className="grid grid-cols-2 gap-2 w-32">
                            <input className="border dark:border-gray-600 p-2 bg-white dark:bg-gray-700 dark:text-white text-center" placeholder="00" value={k00} onChange={e=>setK00(e.target.value)} />
                            <input className="border dark:border-gray-600 p-2 bg-white dark:bg-gray-700 dark:text-white text-center" placeholder="01" value={k01} onChange={e=>setK01(e.target.value)} />
                            <input className="border dark:border-gray-600 p-2 bg-white dark:bg-gray-700 dark:text-white text-center" placeholder="10" value={k10} onChange={e=>setK10(e.target.value)} />
                            <input className="border dark:border-gray-600 p-2 bg-white dark:bg-gray-700 dark:text-white text-center" placeholder="11" value={k11} onChange={e=>setK11(e.target.value)} />
                        </div>
                    </div>
                    <div className="flex">
                        <Button onClick={() => process(true)}>M√£ h√≥a</Button>
                        <Button onClick={() => process(false)} variant="secondary">Gi·∫£i m√£</Button>
                    </div>
                    <ResultBox result={result} steps={steps} />
                </Section>
            );
        };

        const AffineCipher = () => {
            const [text, setText] = useState("");
            const [a, setA] = useState(5);
            const [b, setB] = useState(8);
            const [result, setResult] = useState("");
            const [steps, setSteps] = useState([]);

            const process = (isEncrypt) => {
                let log = [];
                let valA = parseInt(a), valB = parseInt(b);
                if(gcd(valA, 26) !== 1) return alert(`Gi√° tr·ªã a=${valA} kh√¥ng h·ª£p l·ªá! GCD(a, 26) ph·∫£i b·∫±ng 1.`);

                let aInv = modInverse(valA, 26);
                log.push(
                    <div className="mb-4 p-2 bg-blue-50 dark:bg-blue-900/30 rounded border border-blue-100 dark:border-blue-800">
                        <div>H√†m M√£ h√≥a: <span className="math-font">E(x) = ({valA}x + {valB}) mod 26</span></div>
                        <div>H√†m Gi·∫£i m√£: <span className="math-font">D(y) = {aInv}(y - {valB}) mod 26</span></div>
                        <div className="text-sm text-gray-500 italic">Ngh·ªãch ƒë·∫£o c·ªßa {valA} mod 26 l√† {aInv}</div>
                    </div>
                );

                let cleanText = text.toUpperCase().replace(/[^A-Z]/g, "");
                let output = "";

                for(let i=0; i<cleanText.length; i++) {
                    let x = alphabet.indexOf(cleanText[i]);
                    let res, formula;
                    if(isEncrypt) {
                        res = mod(valA * x + valB, 26);
                        formula = <span><span className="font-bold">'{cleanText[i]}'</span>({x}) &rarr; ({valA}&times;{x} + {valB}) = {valA*x+valB} &equiv; {res} &rarr; <span className="font-bold text-red-500">'{alphabet[res]}'</span></span>;
                    } else {
                        res = mod(aInv * (x - valB), 26);
                        formula = <span><span className="font-bold">'{cleanText[i]}'</span>({x}) &rarr; {aInv}&times;({x} - {valB}) = {aInv*(x-valB)} &equiv; {res} &rarr; <span className="font-bold text-red-500">'{alphabet[res]}'</span></span>;
                    }
                    log.push(formula);
                    output += alphabet[res];
                }
                setResult(output);
                setSteps(log);
            }

            return (
                <Section title="M√£ Affine">
                    <InputGroup label="VƒÉn b·∫£n" value={text} onChange={(e) => setText(e.target.value)} />
                    <div className="flex gap-4">
                        <div className="w-1/2"><InputGroup label="H·ªá s·ªë a (GCD(a,26)=1)" type="number" value={a} onChange={(e) => setA(e.target.value)} /></div>
                        <div className="w-1/2"><InputGroup label="H·ªá s·ªë b (ƒë·ªô d·ªãch)" type="number" value={b} onChange={(e) => setB(e.target.value)} /></div>
                    </div>
                    <div className="flex">
                        <Button onClick={() => process(true)}>M√£ h√≥a</Button>
                        <Button onClick={() => process(false)} variant="secondary">Gi·∫£i m√£</Button>
                    </div>
                    <ResultBox result={result} steps={steps} />
                </Section>
            );
        };

        const RSACipher = () => {
            const [p, setP] = useState("");
            const [q, setQ] = useState("");
            const [eVal, setE] = useState("");
            const [nVal, setNVal] = useState("");
            const [message, setMessage] = useState("");
            const [result, setResult] = useState("");
            const [steps, setSteps] = useState([]);
            const [mode, setMode] = useState("pq"); // "pq" or "n"

            const getModExpSteps = (base, exp, m) => {
                let steps = [];
                let binaryExp = exp.toString(2);
                
                if (binaryExp.length > 50) {
                    steps.push(<div className="text-orange-600">S·ªë m≈© qu√° l·ªõn ({binaryExp.length} bits) ƒë·ªÉ hi·ªÉn th·ªã chi ti·∫øt. Ch·ªâ hi·ªÉn th·ªã k·∫øt qu·∫£.</div>);
                    return { val: bigIntPowMod(base, exp, m), steps };
                }

                steps.push(
                    <div className="mb-2">
                        <div><strong>Ph√¢n t√≠ch s·ªë m≈© {exp.toString()} sang nh·ªã ph√¢n:</strong> {binaryExp}</div>
                        <div className="text-sm text-gray-500 italic">S·ª≠ d·ª•ng thu·∫≠t to√°n "Nh√¢n v√† B√¨nh ph∆∞∆°ng" (Square and Multiply)</div>
                    </div>
                );

                let tableRows = [];
                let r = 1n;
                for(let i = 0; i < binaryExp.length; i++) {
                    let bit = binaryExp[i];
                    let oldR = r;
                    
                    let r_sq = (r * r) % m;
                    let opDesc = <span>Square: {oldR.toString()}¬≤ ‚â° <strong>{r_sq.toString()}</strong></span>;
                    r = r_sq;
                    
                    if (bit === '1') {
                        let r_mul = (r * base) % m;
                        opDesc = <span>{opDesc} <br/> Multiply (bit=1): {r.toString()} √ó {base.toString()} ‚â° <strong>{r_mul.toString()}</strong></span>;
                        r = r_mul;
                    } else {
                        opDesc = <span>{opDesc} <br/> (bit=0, gi·ªØ nguy√™n)</span>;
                    }
                    
                    tableRows.push(
                        <tr key={i} className="border-b dark:border-gray-700">
                            <td className="p-2 border-r dark:border-gray-700 text-center">{i+1}</td>
                            <td className="p-2 border-r dark:border-gray-700 text-center font-bold">{bit}</td>
                            <td className="p-2">{opDesc}</td>
                            <td className="p-2 font-bold text-blue-600 text-right">{r.toString()}</td>
                        </tr>
                    );
                }

                steps.push(
                    <div className="overflow-x-auto mt-2">
                        <table className="w-full text-sm border border-collapse dark:border-gray-700">
                            <thead className="bg-gray-100 dark:bg-gray-800">
                                <tr>
                                    <th className="p-2 border border-gray-300 dark:border-gray-600">B∆∞·ªõc</th>
                                    <th className="p-2 border border-gray-300 dark:border-gray-600">Bit</th>
                                    <th className="p-2 border border-gray-300 dark:border-gray-600">Ph√©p t√≠nh (mod {m.toString()})</th>
                                    <th className="p-2 border border-gray-300 dark:border-gray-600">K·∫øt qu·∫£ (R)</th>
                                </tr>
                            </thead>
                            <tbody>{tableRows}</tbody>
                        </table>
                    </div>
                );

                return { val: r, steps: steps };
            };

            const process = (action) => {
                let log = [];
                try {
                    let bigN, bigE, d = null;

                    if (mode === "pq") {
                        const bigP = BigInt(p);
                        const bigQ = BigInt(q);
                        bigE = BigInt(eVal);
                        bigN = bigP * bigQ;
                        const phi = (bigP - 1n) * (bigQ - 1n);
                        
                        log.push(<div>1. T√≠nh <span className="math-font">n = p √ó q</span> = {bigP.toString()} √ó {bigQ.toString()} = <span className="font-bold">{bigN.toString()}</span></div>);
                        log.push(<div>2. T√≠nh <span className="math-font">œÜ(n) = (p-1)(q-1)</span> = {phi.toString()}</div>);

                        const extendedGcdBig = (a, b) => {
                            if (b === 0n) return { gcd: a, x: 1n, y: 0n };
                            const { gcd: g, x: x1, y: y1 } = extendedGcdBig(b, a % b);
                            return { gcd: g, x: y1, y: x1 - (a / b) * y1 };
                        };
                        const { gcd: gVal, x: dVal } = extendedGcdBig(bigE, phi);
                        
                        if (gVal !== 1n) {
                             log.push(<div className="text-red-500 font-bold">L·ªñI: e={bigE.toString()} kh√¥ng nguy√™n t·ªë c√πng nhau v·ªõi œÜ(n)={phi.toString()}. Ch·ªçn e kh√°c.</div>);
                             setSteps(log); return;
                        }
                        d = (dVal % phi + phi) % phi;
                        log.push(<div>3. T√≠nh <span className="math-font">d = e‚Åª¬π mod œÜ(n)</span> = <span className="font-bold text-red-500">{d.toString()}</span></div>);
                        log.push(<div className="mt-2 p-2 border rounded border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700">Kh√≥a c√¥ng khai (PU): <span className="font-bold font-mono">{`{e: ${bigE.toString()}, n: ${bigN.toString()}}`}</span></div>);
                        log.push(<div className="mt-1 p-2 border rounded border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700">Kh√≥a b√≠ m·∫≠t (PR): <span className="font-bold font-mono">{`{d: ${d.toString()}, n: ${bigN.toString()}}`}</span></div>);
                    } else {
                        // Mode N given
                        bigN = BigInt(nVal);
                        bigE = BigInt(eVal);
                        log.push(<div className="mt-2 p-2 border rounded border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700">ƒê·ªÅ b√†i cho: <span className="font-bold font-mono">{`n = ${bigN.toString()}, e = ${bigE.toString()}`}</span></div>);
                        if (action === 'decrypt') {
                             log.push(<div className="text-orange-500 italic">L∆∞u √Ω: Kh√¥ng th·ªÉ gi·∫£i m√£ n·∫øu ch·ªâ bi·∫øt n v√† e (c·∫ßn p, q ƒë·ªÉ t√≠nh d).</div>);
                             setSteps(log); return;
                        }
                    }

                    if (action === 'encrypt' || action === 'decrypt') {
                        if (!message) return alert("Nh·∫≠p th√¥ng ƒëi·ªáp m");
                        const m = BigInt(message);
                        
                        if (action === 'encrypt') {
                            log.push(<div className="mt-4 font-bold border-t pt-2 text-lg text-blue-600">üîπ M√£ h√≥a: C = m<sup>e</sup> mod n</div>);
                            const { val, steps } = getModExpSteps(m, bigE, bigN);
                            log.push(...steps);
                            log.push(<div className="mt-2 text-xl">K·∫øt qu·∫£: <span className="font-bold text-blue-600">{val.toString()}</span></div>);
                            setResult(val.toString());
                        } else {
                            // Decrypt requires d
                            if (d === null) {
                                log.push(<div className="text-red-500">Ch∆∞a t√≠nh ƒë∆∞·ª£c d (c·∫ßn nh·∫≠p p, q).</div>);
                            } else {
                                log.push(<div className="mt-4 font-bold border-t pt-2 text-lg text-blue-600">üîπ Gi·∫£i m√£: M = c<sup>d</sup> mod n</div>);
                                const { val, steps } = getModExpSteps(m, d, bigN);
                                log.push(...steps);
                                log.push(<div className="mt-2 text-xl">K·∫øt qu·∫£: <span className="font-bold text-blue-600">{val.toString()}</span></div>);
                                setResult(val.toString());
                            }
                        }
                    } else {
                        setResult("");
                    }
                } catch (err) {
                    log.push(<div className="text-red-500">L·ªói nh·∫≠p li·ªáu. Vui l√≤ng ki·ªÉm tra l·∫°i c√°c s·ªë nguy√™n.</div>);
                }
                setSteps(log);
            };

            return (
                <Section title="H·ªá m·∫≠t RSA">
                    <div className="mb-4">
                        <label className="block text-gray-700 dark:text-gray-300 font-bold mb-2">Ch·∫ø ƒë·ªô nh·∫≠p:</label>
                        <div className="flex gap-4">
                            <label className="inline-flex items-center cursor-pointer select-none">
                                <input type="radio" className="form-radio text-blue-600" name="rsaMode" value="pq" checked={mode === 'pq'} onChange={() => setMode('pq')} />
                                <span className="ml-2 text-gray-700 dark:text-gray-300">Nh·∫≠p p, q, e (T√≠nh d, M√£ h√≥a & Gi·∫£i m√£)</span>
                            </label>
                            <label className="inline-flex items-center cursor-pointer select-none">
                                <input type="radio" className="form-radio text-blue-600" name="rsaMode" value="n" checked={mode === 'n'} onChange={() => setMode('n')} />
                                <span className="ml-2 text-gray-700 dark:text-gray-300">Nh·∫≠p n, e (Ch·ªâ M√£ h√≥a)</span>
                            </label>
                        </div>
                    </div>

                    {mode === 'pq' ? (
                        <div className="grid grid-cols-3 gap-4">
                            <InputGroup label="p (SNT)" value={p} onChange={(e) => setP(e.target.value)} />
                            <InputGroup label="q (SNT)" value={q} onChange={(e) => setQ(e.target.value)} />
                            <InputGroup label="e (Public Key)" value={eVal} onChange={(e) => setE(e.target.value)} />
                        </div>
                    ) : (
                        <div className="grid grid-cols-2 gap-4">
                            <InputGroup label="n (Modulus)" value={nVal} onChange={(e) => setNVal(e.target.value)} />
                            <InputGroup label="e (Public Key)" value={eVal} onChange={(e) => setE(e.target.value)} />
                        </div>
                    )}

                    {mode === 'pq' && <Button onClick={() => process('calcKeys')} variant="secondary">T√≠nh d & Kh√≥a</Button>}
                    
                    <div className="mt-4 border-t dark:border-gray-600 pt-4">
                        <InputGroup label="Th√¥ng ƒëi·ªáp m / B·∫£n m√£ c" value={message} onChange={(e) => setMessage(e.target.value)} placeholder="Nh·∫≠p s·ªë..." />
                        <div className="flex">
                            <Button onClick={() => process('encrypt')}>M√£ h√≥a (m^e)</Button>
                            {mode === 'pq' && <Button onClick={() => process('decrypt')} variant="secondary">Gi·∫£i m√£ (c^d)</Button>}
                        </div>
                    </div>
                    <ResultBox result={result} steps={steps} />
                </Section>
            );
        };
        
        const DiffieHellman = () => {
            const [p, setP] = useState("23");
            const [g, setG] = useState("5");
            const [a, setA] = useState("6");
            const [b, setB] = useState("15");
            const [result, setResult] = useState("");
            const [steps, setSteps] = useState([]);
            
            const process = () => {
                let log = [];
                try {
                    const bigP = BigInt(p), bigG = BigInt(g), bigA = BigInt(a), bigB = BigInt(b);
                    
                    log.push(<div className="font-bold">Tham s·ªë c√¥ng khai: p={bigP.toString()}, g={bigG.toString()}</div>);
                    log.push(<div>B√≠ m·∫≠t Alice: a={bigA.toString()}</div>);
                    log.push(<div>B√≠ m·∫≠t Bob: b={bigB.toString()}</div>);
                    
                    const A_pub = bigIntPowMod(bigG, bigA, bigP);
                    log.push(<div className="mt-2"><span className="font-bold">1. Alice t√≠nh A</span> = g<sup>a</sup> mod p = {bigG.toString()}<sup>{bigA.toString()}</sup> mod {bigP.toString()} = <span className="font-bold text-blue-600">{A_pub.toString()}</span> (G·ª≠i cho Bob)</div>);
                    
                    const B_pub = bigIntPowMod(bigG, bigB, bigP);
                    log.push(<div><span className="font-bold">2. Bob t√≠nh B</span> = g<sup>b</sup> mod p = {bigG.toString()}<sup>{bigB.toString()}</sup> mod {bigP.toString()} = <span className="font-bold text-blue-600">{B_pub.toString()}</span> (G·ª≠i cho Alice)</div>);
                    
                    const S_Alice = bigIntPowMod(B_pub, bigA, bigP);
                    log.push(<div className="mt-2"><span className="font-bold">3. Alice t√≠nh kh√≥a chung:</span> S = B<sup>a</sup> mod p = {B_pub.toString()}<sup>{bigA.toString()}</sup> mod {bigP.toString()} = <span className="font-bold text-green-600">{S_Alice.toString()}</span></div>);
                    
                    const S_Bob = bigIntPowMod(A_pub, bigB, bigP);
                    log.push(<div><span className="font-bold">4. Bob t√≠nh kh√≥a chung:</span> S = A<sup>b</sup> mod p = {A_pub.toString()}<sup>{bigB.toString()}</sup> mod {bigP.toString()} = <span className="font-bold text-green-600">{S_Bob.toString()}</span></div>);
                    
                    if(S_Alice === S_Bob) setResult(`Kh√≥a chung S = ${S_Alice}`);
                    else setResult("L·ªói t√≠nh to√°n");
                    
                } catch(e) { log.push(<div className="text-red-500">L·ªói nh·∫≠p li·ªáu.</div>); }
                setSteps(log);
            }
            
            return (
                 <Section title="Trao ƒë·ªïi kh√≥a Diffie-Hellman">
                    <div className="grid grid-cols-2 gap-4">
                        <InputGroup label="S·ªë nguy√™n t·ªë p" value={p} onChange={(e) => setP(e.target.value)} />
                        <InputGroup label="CƒÉn nguy√™n th·ªßy g" value={g} onChange={(e) => setG(e.target.value)} />
                        <InputGroup label="S·ªë b√≠ m·∫≠t Alice (a)" value={a} onChange={(e) => setA(e.target.value)} />
                        <InputGroup label="S·ªë b√≠ m·∫≠t Bob (b)" value={b} onChange={(e) => setB(e.target.value)} />
                    </div>
                    <Button onClick={process}>T√≠nh kh√≥a chung</Button>
                    <ResultBox result={result} steps={steps} />
                 </Section>
            )
        }

        const App = () => {
            const [activeTab, setActiveTab] = useState("caesar");
            const [darkMode, setDarkMode] = useState(false);

            useEffect(() => {
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [darkMode]);

            const tabs = [
                { id: "caesar", label: "Caesar" },
                { id: "vigenere", label: "Vigenere" },
                { id: "playfair", label: "Playfair" },
                { id: "hill", label: "Hill" },
                { id: "affine", label: "Affine" },
                { id: "rsa", label: "RSA" },
                { id: "dh", label: "Diffie-Hellman" }
            ];

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-4xl mx-auto transition-colors duration-300">
                    <header className="mb-8 text-center relative">
                         <button onClick={() => setDarkMode(!darkMode)} className="absolute right-0 top-0 p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            {darkMode ? <SunIcon /> : <MoonIcon />}
                        </button>
                        <h1 className="text-3xl md:text-4xl font-extrabold text-gray-800 dark:text-white transition-colors">Crypto Solver</h1>
                        <p className="text-gray-600 dark:text-gray-400 mt-2 transition-colors">C√¥ng c·ª• gi·∫£i b√†i t·∫≠p M·∫≠t M√£ H·ªçc chi ti·∫øt</p>
                    </header>

                    <div className="flex flex-wrap gap-2 mb-6 justify-center">
                        {tabs.map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                className={`px-4 py-2 rounded-full font-medium transition-all duration-300 text-sm md:text-base ${
                                    activeTab === tab.id 
                                    ? "bg-blue-600 text-white shadow-lg transform scale-105" 
                                    : "bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                                }`}
                            >
                                {tab.label}
                            </button>
                        ))}
                    </div>

                    <main>
                        <div style={{ display: activeTab === 'caesar' ? 'block' : 'none' }}><CaesarCipher /></div>
                        <div style={{ display: activeTab === 'vigenere' ? 'block' : 'none' }}><VigenereCipher /></div>
                        <div style={{ display: activeTab === 'playfair' ? 'block' : 'none' }}><PlayfairCipher /></div>
                        <div style={{ display: activeTab === 'hill' ? 'block' : 'none' }}><HillCipher /></div>
                        <div style={{ display: activeTab === 'affine' ? 'block' : 'none' }}><AffineCipher /></div>
                        <div style={{ display: activeTab === 'rsa' ? 'block' : 'none' }}><RSACipher /></div>
                        <div style={{ display: activeTab === 'dh' ? 'block' : 'none' }}><DiffieHellman /></div>
                    </main>
                    
                    <footer className="text-center text-gray-500 dark:text-gray-400 text-sm mt-12 pb-4 transition-colors">
                        ƒê∆∞·ª£c x√¢y d·ª±ng ƒë·ªÉ h·ªó tr·ª£ h·ªçc t·∫≠p m√¥n An to√†n th√¥ng tin.
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
